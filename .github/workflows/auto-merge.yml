name: Auto Merge

on:
  schedule:
    - cron: "0 5 * * *"   # Every day at 05:00 UTC
  workflow_dispatch:

jobs:
  merge:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: write
    steps:
      - uses: actions/checkout@v4

      - name: Auto approve & merge all passing PRs
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "🔁 Checking open PRs..."
          prs=$(gh pr list --state open --json number -q '.[].number')
          for pr in $prs; do
            echo "➡️  Processing PR #$pr"
            gh pr checks $pr --watch || true
            gh pr merge $pr --squash --admin || echo "⚠️ Could not merge PR #$pr"
          done
